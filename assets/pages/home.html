<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CONTROLE SUPPORT TI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/moblie.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/assets/css/home.css">

</head>

<body>

    <section class="container-custom">


        <section class="cabecalho">
          
                <div class="mt-5"></div>
                <div class="d-flex flex-column flex-md-row justify-content-md-between align-items-center">
                    <p class="text-header">Home</p>
                    
                    <i class="bi bi-funnel-fill" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#configuracao"></i>
                </div>
                <hr class="line">
        </section>

<!-- Modal -->
<div class="modal fade" id="configuracao" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Configurações de exibição</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="container">
                <div class="row mt-3">
                    <div class="col">
                        <label for="totalInput">Ficar vermelho itens abaixo de:</label>
                        <input type="number" id="totalInput" class="form-control">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label for="yellowLimit">Total de itens para amarelo acima de:</label>
                        <input type="number" id="yellowLimit" class="form-control">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label for="greenLimit">Total de itens para verde acima de:</label>
                        <input type="number" id="greenLimit" class="form-control">
                    </div>
                </div>
                
              
            </div>
            
            
        </div>
        <div class="modal-footer">
          <button type="button" id="updateColor" class="btn btn-primary">Atualizar Cor</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>


        <section class="dados">
            <div class="mt-2"></div>
            <div>
                <div class="mt-4"></div>
                <div class="dadosmobile">
                    <div class="positiondados">
                        <!-- HTML -->
                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4" id="dynamicData">
                            <!-- Os itens serão adicionados aqui dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="mt-4"></div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- <script>
    $(document).ready(function () {
    // Faz uma solicitação AJAX para obter os dados das tabelas
    $.get('/dadosRegistros', function (data) {
        // Limpa a tabela
        $('#dynamicData').empty();

        // Adiciona os dados recebidos na tabela
        data.forEach(function (item) {
            var element = `
                <div class="col">
                    <div class="custom-div">
                        <p class="texttemp">${item.tabela}</p>
                        <div class="spacetime"></div>
                        <p class="banconumber">${item.total}</p>
                    </div>
                </div>`;
            $('#dynamicData').append(element);
        });
    });
});

    </script> -->
  



    <script>
        $(document).ready(function () {
            // Função para recuperar os limites de cores do Local Storage
            function recuperarLimitesLocalStorage() {
                var yellowLimit = localStorage.getItem('yellowLimit');
                var greenLimit = localStorage.getItem('greenLimit');
    
                if (yellowLimit !== null && greenLimit !== null) {
                    $('#yellowLimit').val(yellowLimit);
                    $('#greenLimit').val(greenLimit);
                }
            }
    
            // Função para recuperar as cores do Local Storage
            function recuperarCoresLocalStorage() {
                var coresSalvas = localStorage.getItem('cores');
                if (coresSalvas) {
                    var cores = JSON.parse(coresSalvas);
                    for (var id in cores) {
                        $('#' + id).css('background-color', cores[id]);
                    }
                }
            }
    
            // Função para salvar as cores no Local Storage
            function salvarCoresLocalStorage() {
                var cores = {};
                $('.custom-div').each(function () {
                    var id = $(this).attr('id');
                    var cor = $(this).css('background-color');
                    cores[id] = cor;
                });
                localStorage.setItem('cores', JSON.stringify(cores));
            }
    
            // Recupera os limites de cores do Local Storage quando a página é carregada
            recuperarLimitesLocalStorage();
            // Recupera as cores salvas no Local Storage quando a página é carregada
            recuperarCoresLocalStorage();
    
            // Faz uma solicitação AJAX para obter os limites de cores salvos no servidor
            $.get('/obterLimitesCores', function (data) {
                // Atualiza os inputs com os valores recuperados do servidor
                $('#totalInput').val(data.vermelho);
    
                // Se os valores do servidor não estiverem definidos, recupere do Local Storage
                if (data.amarelo === null || data.verde === null) {
                    recuperarLimitesLocalStorage();
                } else {
                    $('#yellowLimit').val(data.amarelo);
                    $('#greenLimit').val(data.verde);
                }
    
                // Atualiza as cores com base nos valores recuperados
                atualizarCores();
            });
    
            // Faz uma solicitação AJAX para obter os dados das tabelas
            $.get('/dadosRegistros', function (data) {
                // Limpa a tabela
                $('#dynamicData').empty();
    
                // Adiciona os dados recebidos na tabela
                data.forEach(function (item) {
                    var element = `
                        <div class="col">
                            <div id="custom-div-${item.id}" class="custom-div">
                                <p class="texttemp">${item.tabela}</p>
                                <div class="spacetime"></div>
                                <p class="banconumber">${item.total}</p>
                            </div>
                        </div>`;
                    $('#dynamicData').append(element);
                });
    
                // Após adicionar os elementos, recupera as cores salvas no Local Storage
                recuperarCoresLocalStorage();
            });
    
            // Adiciona um evento de clique para o botão de atualizar
            $('#updateColor').click(function () {
                // Atualiza as cores com base nos valores dos inputs
                atualizarCores();
    
                // Envia os valores dos inputs para o servidor
                var totalLimit = $('#totalInput').val();
                var yellowLimit = $('#yellowLimit').val();
                var greenLimit = $('#greenLimit').val();
    
                $.ajax({
                    url: '/salvarLimitesCores', // Rota para salvar os limites no servidor
                    type: 'POST',
                    data: {
                        totalLimit: totalLimit,
                        yellowLimit: yellowLimit,
                        greenLimit: greenLimit
                    },
                    success: function (response) {
                        // Se a solicitação for bem-sucedida, atualize as cores
                        atualizarCores();
    
                        // Salva os limites de cores no Local Storage
                        localStorage.setItem('yellowLimit', yellowLimit);
                        localStorage.setItem('greenLimit', greenLimit);
                    },
                    error: function () {
                        console.error('Erro ao salvar os limites de cores.');
                    }
                });
            });
    
            // Função para atualizar as cores
            function atualizarCores() {
                // Verifica se os limites de cores foram definidos corretamente
                var yellowLimit = parseInt($('#yellowLimit').val());
                var greenLimit = parseInt($('#greenLimit').val());
                if (isNaN(yellowLimit) || isNaN(greenLimit)) {
                    console.error('Erro: Os limites de cores não foram definidos corretamente.');
                    return;
                }
    
                $('.custom-div').each(function () {
                    var total = parseInt($(this).find('.banconumber').text());
    
                    // Define a cor de fundo da custom-div
                    if (total < yellowLimit) {
                        $(this).css('background-color', 'red');
                    } else if (total < greenLimit) {
                        $(this).css('background-color', 'yellow');
                    } else {
                        $(this).css('background-color', 'green');
                    }
    
                    // Define a cor do texto dentro de banconumber como preto
                    $(this).find('.banconumber').css('color', 'black');
                });
    
                // Salva as cores no Local Storage
                salvarCoresLocalStorage();
            }
        });
    </script>
</body>

</html>